{% extends "base.html" %}
{% block title %}Run Probe{% endblock %}
{% block content %}
<div class="page-grid">
  <section class="card">
    <h1>Configure a Probe Run</h1>

    {% if error_message %}
      <div class="alert error">
        Run failed: {{ error_message }}
      </div>
    {% endif %}

    <form method="post" class="form-grid">
      <label>
        Model
        <select name="model_name">
          {% for m in models %}
          <option value="{{ m }}" {% if m == preselected_model %}selected{% endif %}>{{ m }}</option>
          {% endfor %}
        </select>
      </label>

      <label>
        Task
        <select name="task_name">
          {% for key, label in tasks.items() %}
          <option value="{{ key }}" {% if key == preselected_task %}selected{% endif %}>
            {{ label }}
          </option>
          {% endfor %}
        </select>
      </label>

      <label>
        Max samples
        <input type="number" name="max_samples" value="500" min="100" max="5000">
        <small>Higher = smoother curves, lower = faster runs.</small>
      </label>

      <label>
        Max sequence length
        <input type="number" name="max_length" value="64" min="32" max="256">
      </label>

      <button type="submit" class="primary-btn" data-run-button>
        ðŸš€ Launch Probing Run
      </button>
    </form>
  </section>

  <section class="card">
    <h2>What happens under the hood?</h2>
    <ol class="steps-list">
      <li>Download & cache the dataset (Kaggle or NLTK).</li>
      <li>Sample N examples and split into train/test.</li>
      <li>Extract hidden states from every transformer layer.</li>
      <li>Train a logistic regression probe per layer.</li>
      <li>Compute accuracy, weighted F1, and calibration error.</li>
    </ol>
    <p>
      The result is a <strong>profile of information flow</strong> across depth:
      where sentiment, toxicity, or structure becomes most linearly separable.
    </p>
  </section>
</div>
{% endblock %}
