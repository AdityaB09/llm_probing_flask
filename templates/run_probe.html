{% extends "base.html" %}
{% block content %}
<div class="row g-4">
  <div class="col-lg-6">
    <div class="card card-panel">
      <div class="card-body">
        <h3 class="card-title text-panel mb-3">Configure a Probe Run</h3>

        {% if error_message %}
        <div class="alert alert-danger small">
          <strong>Run failed:</strong> {{ error_message }}
        </div>
        {% endif %}

        <form method="post" onsubmit="showLoadingOverlay()">
          <div class="mb-3">
            <label class="form-label text-panel">Model</label>
            <select class="form-select form-select-sm" name="model_name">
              {% for m in models %}
              <option value="{{ m }}"
                {% if preselected_model==m %}selected{% endif %}>
                {{ m }}
              </option>
              {% endfor %}
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label text-panel">Task</label>
            <select class="form-select form-select-sm" name="task_name">
              {% for key, label in tasks.items() %}
              <option value="{{ key }}"
                {% if preselected_task==key %}selected{% endif %}>
                {{ label }}
              </option>
              {% endfor %}
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label text-panel">Max samples</label>
            <input type="number" name="max_samples"
                   class="form-control form-control-sm"
                   value="500" min="100" max="5000">
            <div class="form-text text-subtle">
              Higher = smoother curves, lower = faster runs.
            </div>
          </div>

          <div class="mb-4">
            <label class="form-label text-panel">Max sequence length</label>
            <input type="number" name="max_length"
                   class="form-control form-control-sm"
                   value="64" min="32" max="256">
          </div>

          <button type="submit"
                  class="btn btn-accent w-100 btn-lg shadow-glow">
            ðŸš€ Launch Probing Run
          </button>
        </form>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="card card-panel h-100">
      <div class="card-body">
        <h4 class="card-title text-panel mb-3">
          What happens under the hood?
        </h4>
        <ol class="text-panel-subtle small">
          <li>Download & cache the dataset (Kaggle or NLTK).</li>
          <li>Sample N examples and split into train/test.</li>
          <li>Extract hidden states from every transformer layer.</li>
          <li>Train a logistic regression probe per layer.</li>
          <li>Compute accuracy, weighted F1, and calibration error.</li>
        </ol>
        <p class="text-panel-subtle small mb-0">
          The result is a <strong>profile of information flow</strong> across
          depth: where sentiment, toxicity, or structure becomes most linearly
          separable.
        </p>
      </div>
    </div>
  </div>
</div>
{% endblock %}
