{% extends "base.html" %}
{% block title %}
Results: {{ model_name }} on {{ task_label }}
{% endblock %}
{% block content %}
<div class="results-page">
  <header class="results-header">
    <h1>Results: {{ model_name }} on {{ task_label }}</h1>
    <p class="results-meta">
      Samples: {{ result.num_samples }} · Layers: {{ result.num_layers }} · Classes: {{ result.num_classes }}
    </p>
    <a class="secondary-btn" href="{{ url_for('run_detail', run_id=run_record.run_id) }}">
      View in history
    </a>
  </header>

  <section class="results-grid">
    <div class="card">
      <h2>Layerwise Accuracy &amp; F1</h2>
      <div class="chart-container">
        <canvas id="metricsChart"></canvas>
      </div>
    </div>

    <div class="card">
      <h2>Calibration Error (ECE)</h2>
      <div class="chart-container">
        <canvas id="eceChart"></canvas>
      </div>
    </div>

    <div class="card">
      <h2>Information Flow Radar</h2>
      <div class="chart-container">
        <canvas id="radarChart"></canvas>
      </div>
    </div>
  </section>

  <section class="results-bottom-grid">
    <div class="card">
      <h2>What did we learn?</h2>
      <p class="summary-text">
        {{ explanation|safe }}
      </p>
    </div>

    <div class="card">
      <h2>Sample predictions from best layer ({{ result.best_layer_index }})</h2>
      {% if example_predictions %}
        <ul class="sample-predictions">
          {% for ex in example_predictions %}
          <li>
            <div class="sample-text">“{{ ex.text }}”</div>
            <div class="sample-meta">
              <span>True: {{ ex.gold }}</span>
              <span>Pred: {{ ex.pred }}</span>
              <span>Conf: {{ "%.3f"|format(ex.confidence) }}</span>
            </div>
          </li>
          {% endfor %}
        </ul>
      {% else %}
        <p>No sample predictions were stored for this run.</p>
      {% endif %}
    </div>
  </section>

  <script>
    const layerMetrics = {{ result.layer_metrics | tojson }};
    const radarData = {{ radar_data | tojson }};
    window.addEventListener("load", () => {
      initResultsCharts(layerMetrics);
      initRadarChart(radarData);
    });
  </script>
</div>
{% endblock %}
