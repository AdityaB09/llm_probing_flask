{% extends "base.html" %}
{% block title %}Run {{ run.run_id }}{% endblock %}
{% block content %}
<section class="card">
  <h1>Run {{ run.run_id }}</h1>
  <p>
    <strong>Model:</strong> {{ run.model_name }} ·
    <strong>Task:</strong> {{ task_label }} ·
    <strong>Timestamp:</strong> {{ run.timestamp }}
  </p>
  <p>
    Max samples: {{ run.max_samples }},
    Max seq len: {{ run.max_length }},
    Best layer: {{ run.best_layer }},
    Best F1: {{ "%.3f"|format(run.best_f1) }}
  </p>
  <p class="summary-text">{{ explanation|safe }}</p>
  <p>
    <a href="{{ url_for('download_report', run_id=run.run_id) }}" class="secondary-btn">
      ⬇ Download Markdown report
    </a>
  </p>
</section>

<section class="card">
  <h2>Information Flow Radar</h2>
  <div class="chart-container">
    <canvas id="radarChart"></canvas>
  </div>
</section>

<section class="card">
  <h2>Your notes</h2>
  <form method="post" action="{{ url_for('add_note', run_id=run.run_id) }}">
    <textarea name="note" rows="4" placeholder="Add your interpretation or caveats here...">{{ run.note or "" }}</textarea>
    <button type="submit" class="primary-btn">Save note</button>
  </form>
</section>

<script>
  const radarData = {{ radar_data | tojson }};
  window.addEventListener("load", () => {
    initRadarChart(radarData);
  });
</script>
{% endblock %}
